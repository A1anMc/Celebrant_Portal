{% extends "base.html" %}

{% block title %}Dashboard - Marriage Celebrant Portal{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-modern">
        <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
    </ol>
</nav>

<!-- Action Bar -->
<div class="action-bar">
    <div class="title-section">
        <h1>Dashboard</h1>
        <div class="subtitle">Your celebrant portal overview</div>
    </div>
    <div class="actions">
        <a href="{{ url_for('couple_new') }}" class="btn-primary-action" data-bs-toggle="tooltip" data-bs-placement="top" title="Add a new couple">
            <i class="bi bi-plus-circle"></i> New Couple
        </a>
    </div>
</div>

<!-- Dashboard Navigation Tabs -->
<ul class="nav nav-tabs nav-tabs-modern" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
            <i class="bi bi-house-heart"></i> Overview
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="ceremonies-tab" data-bs-toggle="tab" data-bs-target="#ceremonies" type="button" role="tab">
            <i class="bi bi-calendar-heart"></i> Upcoming Ceremonies
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="actions-tab" data-bs-toggle="tab" data-bs-target="#actions" type="button" role="tab">
            <i class="bi bi-lightning"></i> Quick Actions
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="dashboardTabContent">
    <!-- Overview Tab -->
    <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <div class="row">
            <!-- Quick Stats -->
            <div class="col-lg-8">
                <div class="card card-modern mb-4">
                    <div class="card-header card-header-modern">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-graph-up"></i> Quick Statistics
                        </h5>
                    </div>
                    <div class="card-body card-body-modern">
                        <div class="row g-3">
                            <div class="col-md-3 col-sm-6">
                                <div class="dashboard-card text-center">
                                    <div class="stat text-primary">{{ couples|selectattr('ceremony_date')|list|length }}</div>
                                    <div class="stat-label">Upcoming</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="dashboard-card text-center">
                                    <div class="stat text-success">{{ couples|selectattr('status', 'equalto', 'Confirmed')|list|length }}</div>
                                    <div class="stat-label">Confirmed</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="dashboard-card text-center">
                                    <div class="stat text-warning">{{ couples|selectattr('status', 'equalto', 'Inquiry')|list|length }}</div>
                                    <div class="stat-label">Inquiries</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="dashboard-card text-center">
                                    <div class="stat text-info">{{ couples|selectattr('status', 'equalto', 'Completed')|list|length }}</div>
                                    <div class="stat-label">Completed</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Sidebar -->
            <div class="col-lg-4">
                <div class="card card-modern mb-4">
                    <div class="card-header card-header-modern">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-lightning"></i> Quick Actions
                        </h5>
                    </div>
                    <div class="card-body card-body-modern">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('couple_new') }}" class="btn-primary-action">
                                <i class="bi bi-plus-circle"></i> Add New Couple
                            </a>
                            <a href="{{ url_for('templates_list') }}" class="btn-secondary-action">
                                <i class="bi bi-file-earmark-text"></i> Manage Templates
                            </a>
                            <a href="{{ url_for('scan_emails') }}" class="btn-secondary-action">
                                <i class="bi bi-envelope-heart"></i> Scan Emails
                            </a>
                            <a href="{{ url_for('maps_travel') }}" class="btn-secondary-action">
                                <i class="bi bi-geo-alt"></i> Travel Calculator
                            </a>
                            <a href="{{ url_for('legal_forms.compliance_dashboard') }}" class="btn-secondary-action">
                                <i class="bi bi-clipboard-check"></i> Legal Forms
                            </a>
                            <a href="{{ url_for('invoices.index') }}" class="btn-secondary-action">
                                <i class="bi bi-receipt"></i> Invoices
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ceremonies Tab -->
    <div class="tab-pane fade" id="ceremonies" role="tabpanel">
        <div class="card card-modern">
            <div class="card-header card-header-modern">
                <h5 class="card-title mb-0">
                    <i class="bi bi-calendar-heart"></i> Upcoming Ceremonies
                </h5>
            </div>
            <div class="card-body card-body-modern">
                {% if couples %}
                    <div class="table-responsive">
                        <table class="table table-modern">
                            <thead>
                                <tr>
                                    <th>Couple</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for couple in couples %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                    <i class="bi bi-people text-primary"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="fw-semibold">{{ couple.partner1_name }} & {{ couple.partner2_name }}</div>
                                                <small class="text-muted">{{ couple.partner1_email }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if couple.ceremony_date %}
                                            <div class="fw-semibold">{{ couple.ceremony_date.strftime('%d %b %Y') }}</div>
                                            <small class="text-muted">
                                                {% set days_until = (couple.ceremony_date - today).days if couple.ceremony_date else 0 %}
                                                {% if days_until > 0 %}
                                                    <i class="bi bi-clock text-success me-1"></i>{{ days_until }} days away
                                                {% elif days_until == 0 %}
                                                    <i class="bi bi-exclamation-circle text-warning me-1"></i>Today!
                                                {% else %}
                                                    <i class="bi bi-check-circle text-muted me-1"></i>{{ -days_until }} days ago
                                                {% endif %}
                                            </small>
                                        {% else %}
                                            <span class="text-muted">TBD</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if couple.ceremony_location %}
                                            <div class="fw-semibold">{{ couple.ceremony_location[:30] }}{% if couple.ceremony_location|length > 30 %}...{% endif %}</div>
                                            {% if couple.travel_fee %}
                                                <small class="text-muted">Travel: ${{ "%.2f"|format(couple.travel_fee) }}</small>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-muted">TBD</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="status-badge {{ couple.status.lower() }}">
                                            {{ couple.status }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{{ url_for('couple_view', id=couple.id) }}" class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a href="{{ url_for('couple_edit', id=couple.id) }}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if couples|length > 5 %}
                        <div class="text-center mt-3">
                            <a href="{{ url_for('couples_list') }}" class="btn-secondary-action">
                                <i class="bi bi-arrow-right"></i> View All Couples
                            </a>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <div class="mb-3">
                            <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                        </div>
                        <h5 class="text-muted mb-3">No upcoming ceremonies</h5>
                        <p class="text-muted mb-4">Start by adding your first couple to get organized!</p>
                        <a href="{{ url_for('couple_new') }}" class="btn-primary-action">
                            <i class="bi bi-plus-circle"></i> Add First Couple
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions Tab -->
    <div class="tab-pane fade" id="actions" role="tabpanel">
        <div class="quick-actions">
            <a href="{{ url_for('couple_new') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Add a new couple to your client list">
                <i class="bi bi-plus-circle"></i>
                <div class="label">Add Couple</div>
            </a>
            <a href="{{ url_for('templates_list') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Manage email templates">
                <i class="bi bi-file-earmark-text"></i>
                <div class="label">Templates</div>
            </a>
            <a href="{{ url_for('scan_emails') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Scan emails for new inquiries">
                <i class="bi bi-envelope-heart"></i>
                <div class="label">Scan Emails</div>
            </a>
            <a href="{{ url_for('maps_travel') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Calculate travel distances and fees">
                <i class="bi bi-geo-alt"></i>
                <div class="label">Travel Calculator</div>
            </a>
            <a href="{{ url_for('legal_forms.compliance_dashboard') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Manage legal forms and compliance">
                <i class="bi bi-clipboard-check"></i>
                <div class="label">Legal Forms</div>
            </a>
            <a href="{{ url_for('invoices.index') }}" class="quick-action-btn" data-bs-toggle="tooltip" title="Manage invoices and payments">
                <i class="bi bi-receipt"></i>
                <div class="label">Invoices</div>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add today's date for template calculations
const today = new Date();

// Tab functionality
document.addEventListener('DOMContentLoaded', function() {
    // Store active tab in localStorage
    const tabs = document.querySelectorAll('#dashboardTabs .nav-link');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            localStorage.setItem('activeDashboardTab', this.id);
        });
    });

    // Restore active tab from localStorage
    const activeTab = localStorage.getItem('activeDashboardTab');
    if (activeTab) {
        const tab = document.getElementById(activeTab);
        if (tab) {
            const tabInstance = new bootstrap.Tab(tab);
            tabInstance.show();
        }
    }
});
</script>
{% endblock %} 